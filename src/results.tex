%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Results
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Results}
\subsection{iEEG recording and neural trajectory in MTL regions during a Sternberg task}
We employed a publicly available dataset \cite{boran_dataset_2020} for this analysis. This dataset includes LFP signals (Figure 1A) within MTL regions (Table~\ref{tab:01}1) during a modified Sternberg task. SWR$^+$ candidates were detected from LFP signals passed through the ripple band (80--140 Hz) (Figure 1B) within all hippocampal regions (refer to Methods), while SWR$^-$ candidates were defined at identical timestamps of SWR$^+$ candidates but with shuffled across different trials (Figure 1). The multiunit spikes (Figure 1C) are included in the dataset as well, being established using a spike sorting algorithm \cite{niediek_reliable_2016}. Using the 50-ms binned multiunit activity without overlaps, we employed GPFA \cite{yu_gaussian-process_2009} to determine the neural trajectory (or factors) of the MTL regions by session and region (Figure 1D). Each factor was z-normalized by session and region (for example, session \#2 in AHL of subject \#1). The Euclidean distance from the origin ($O$) was calculated (Figure 1E).

\subsection{Hippocampal neural trajectory correlated with a Sternberg task}
In Figure 2A, the median neural trajectories of 50 trials were depicted as point clouds within the three major factor space. The optimal embedding dimension for the GPFA model was determined to be three using the elbow method (Figure 2B). The trajectory distance from the origin ($O$) ($\mathrm{\lVert g_{F} \rVert}$, $\mathrm{\lVert g_{E} \rVert}$, $\mathrm{\lVert g_{M} \rVert}$, and $\mathrm{\lVert g_{R} \rVert}$) of the hippocampus was larger than those of the EC and amygdala (Figure C \& D).\footnote{Hippocampus: Distance = 1.11 [1.01], median [IQR], \textit{n} = 195,681 timepoints; EC: Distance = 0.94 [1.10], median [IQR], \textit{n} = 133,761 timepoints; Amygdala: Distance = 0.78 [0.88], median [IQR], \textit{n} = 165,281 timepoints.}
\\
\indent
Similarly, the distance among geometric medians of the four phases were calculated: $\mathrm{\lVert g_{F}g_{E} \rVert}$, $\mathrm{\lVert g_{F}g_{M} \rVert}$, $\mathrm{\lVert g_{F}g_{R} \rVert}$, $\mathrm{\lVert g_{E}g_{M} \rVert}$, $\mathrm{\lVert g_{E}g_{R} \rVert}$, and $\mathrm{\lVert g_{M}g_{R} \rVert}$. Again, the hippocampus showed larger distances among phases compared to both the EC and amygdala. \footnote{Hippocampus: Distance = 0.60 [0.70], median [IQR], \textit{n} = 8,772 combinations; EC: Distance = 0.28 [0.52], median [IQR], \textit{n} = 5,017 combinations (\textit{p} $<$ 0.01; Brunner--Munzel test); Amygdala: Distance = 0.24 [0.42], median [IQR], \textit{n} = 7,466 combinations (\textit{p} $<$ 0.01; Brunner--Munzel test).}

\subsection{Memory load-dependent neural trajectory distance between the encoding and retrieval states in the hippocampus}
Regarding the memory load of the Stenberg task, correct rate of trials and set size (= the number of alphabetical letters to encode) were negatively correlated (Figure 3A). \footnote{Correct rate: set size four (0.99 \textpm 0.11, mean \textpm SD; \textit{n} = 333 trials) vs. set size six (0.93 \textpm 0.26; \textit{n} = 278 trials; \textit{p} $<$ 0.001, Brunner--Munzel test with Bonferroni correction) and set size eight (0.87 \textpm 0.34; \textit{n} = 275 trials; \textit{p} $<$ 0.05; Brunner--Munzel test with Bonferroni correction). Overall, \textit{p} $<$ 0.001 for Kruskal--Wallis test; correlation coefficient = - 0.20, \textit{p} $<$ 0.001.} Similarly, response time and set size were positively correlated (Figure 3B).\footnote{Response time: set size four (1.26 \textpm 0.45 s; \textit{n} = 333 trials) vs. set size six (1.53 \textpm 0.91 s; \textit{n} = 278 trials) and set size eight (1.66 \textpm 0.80 s; \textit{n} = 275 trials). All comparisons \textit{p} $<$ 0.001, Brunner--Munzel test with Bonferroni correction; \textit{p} $<$ 0.001 for Kruskal--Wallis test; correlation coefficient = 0.22, \textit{p} $<$ 0.001}
\\
\indent
Furthermore, similarly, set size and the trajectory distance between the encoding and retrieval phases ($\mathrm{log_{10}\lVert g_{E}g_{R} \rVert}$) were positively correlated (Figure 3C).\footnote{Correlation between set size and $\mathrm{log_{10}(\lVert g_{E}g_{R} \rVert}$): correlation coefficient = 0.05, \textit{p} $<$ 0.001. Specific values: $\mathrm{\lVert g_{E}g_{R} \rVert}$ = 0.54 [0.70] for set size four trials, \textit{n} = 447; $\mathrm{\lVert g_{E}g_{R} \rVert}$ = 0.58 [0.66] for set size six trials, \textit{n} = 381; $\mathrm{\lVert g_{E}g_{R} \rVert}$ = 0.61 [0.63] for set size eight trials, \textit{n} = 395.}, while distances between other phase combinations did not yield no significant correlations (Figures 3D \& S2).

\subsection{Detection of hippocampal SWR from putative CA1 regions}
Under the aim to improve the precision of recording sites and the detection of SWRs, we estimated electrodes in CA1 regions of the hippocampus based on observing distinct multiunit spike patterns during SWR events. For each session and hippocampal region, SWR$^+$/SWR$^-$ candidates were embedded into a two-dimensional space via UMAP (Figure 4A).\footnote{For illustrative purposes, consider the AHL in session \#1 of subject \#1.} We calculated the silhouette score as a measure of clustering quality (Figure 4B \& Table~\ref{tab:02}). Recording sites with an average silhouette score across sessions exceeding 0.6 were defined as putative CA1 regions \footnote{The identified regions were: AHL of subject \#1, AHR of subject \#3, PHL of subject \#4, AHL of subject \#6, and AHR of subject \#9.}  (Tables~\ref{tab:02} \& \ref{tab:03}). Five putative CA1 regions were identified, and the four of them had not been labeled as seizure onset zones (Table~\ref{tab:01}).
\\
\indent
Subsequently, SWR$^+$/SWR$^-$ candidates within these putative CA1 regions were labeled SWR$^+$ and SWR$^-$, respectively\footnote{Definitions lead to equal counts for both categories: SWR$^+$ (\textit{n} = 1,170) and SWR$^-$ (\textit{n} = 1,170).}  (Table~\ref{tab:03}). Both SWR$^+$ and SWR$^-$ exhibited an identical duration\footnote{Definitions lead to equal duration for both categories: SWR$^+$ (93.0 [65.4] ms) and SWR$^-$ (93.0 [65.4] ms).}  (Figure 4C) due to their definitions, following a log-distribution profile. A increase in SWR$^+$ incidence was detected during the initial 400 ms of the retrieval phase \footnote{SWR$^+$ increased against the bootstrap sample; 95th percentile = 0.42 [Hz]; \textit{p} $<$ 0.05.}  (Figure 4D). Additionally, the peak ripple band amplitude of SWR$^+$ exceeded that of SWR$^-$ and followed a log-normal distribution (Figure 4E).\footnote{SWR$^+$ (3.05 [0.85] SD of baseline, median [IQR]; \textit{n} = 1,170) vs. SWR$^-$ (2.37 [0.33] SD of baseline, median [IQR]; \textit{n} = 1,170; \textit{p} $<$ 0.001; Brunner--Munzel test).}.

\subsection{Transient neural trajectory change in the hippocampus during SWR}
The \textit{distances} of trajectory from the origin ($O$) during SWR events in both the encoding and retrieval phases were calculated (Figure 5A). Given the distance increase during SWR as shown in Figure 5A, we categorized each SWR into three stages: pre-, mid-, and post-SWR. Subsequently, the distances from $O$ during these SWR periods are represented as $\mathrm{\lVert \text{pre-eSWR}^+ \rVert}$, $\mathrm{\lVert \text{mid-eSWR}^+ \rVert}$, and so on.
\\
\indent
$\mathrm{\lVert \text{mid-eSWR}^+ \rVert}$
\footnote{1.25 [1.30], median [IQR], \textit{n} = 1,281, in Match IN task; 1.12 [1.35], median [IQR], \textit{n} = 1,163, in Mismatch OUT task}
was larger than $\mathrm{\lVert \text{pre-eSWR}^+ \rVert}$
\footnote{1.08 [1.07], median [IQR], \textit{n} = 1,149, in Match IN task; 0.90 [1.12], median [IQR], \textit{n} = 1,088, in Mismatch OUT task}
, and $\mathrm{\lVert \text{mid-rSWR}^+ \rVert}$
\footnote{1.32 [1.24], median [IQR], \textit{n} = 935, in Match IN task; 1.15 [1.26], median [IQR], \textit{n} = 891, in Mismatch OUT task}
was larger than $\mathrm{\lVert \text{pre-rSWR}^+ \rVert}$ in both Match IN and Mismatch OUT tasks.
\footnote{1.19 [0.96], median [IQR], \textit{n} = 673, in Match IN task; 0.94 [0.88], median [IQR], \textit{n} = 664, in Mismatch OUT task}

\subsection{Visualization of hippocampal neural trajectory during SWR in two-dimensional spaces}
Based on our observations of neural trajectory 'jump' during SWR (Figure 5), we visualized the three-dimensional trajectories of pre-, mid-, and post-SWR events during the encoding and retrieval phases (Figure 6), the distance between which was memory-load dependendent (Figure 3).
\\
\indent
To achieve the visualization in two dimension spaces, peri-SWR trajectories were linearly aligned by positioning $\mathrm{g_{E}}$ at the origin (0, 0) and $\mathrm{g_{R}}$ at ($\mathrm{\lVert g_{E}g_{R} \rVert}$, 0). These aligned trajectories were rotated around the $\mathrm{g_{E}g_{R}}$ axis (= x-axis). Thus, distances from the origin $O$ and angles between $\mathrm{g_{E}g_{R}}$ in the original three-dimensional spaces are preserved in these two-dimensional ones.
\\
\indent
The scatter plot in these two-dimensional spaces illustrates characteristic distributions of peri-SWR trajectories based on phases and task types. For instance, it is observable that $\mathrm{\lVert \text{mid-eSWR}^+ \rVert}$ is larger than $\mathrm{\lVert \text{pre-eSWR}^+ \rVert}$ (Figure 6B), consistent with our earlier findings (Figure 5).

\subsection{Fluctuations of hippocampal neural trajectories between encoding and retrieval states}
Subsequently, we checked trajectory \textit{directions} based on $\overrightarrow{\mathrm{g_{E}g_{R}}}$. SWR directions were defined by neural trajectory at $-250$ ms and $+250$ ms from their center (\textit{i.e.}, $\overrightarrow{\mathrm{eSWR^+}}$).
\\
\indent
The density of $\overrightarrow{\mathrm{eSWR}} \cdot \overrightarrow{\mathrm{g_{E}g_{R}}}$, $\overrightarrow{\mathrm{rSWR}} \cdot \overrightarrow{\mathrm{g_{E}g_{R}}}$, and $\overrightarrow{\mathrm{eSWR}} \cdot \overrightarrow{\mathrm{rSWR}}$ were calculated (Figure 7A--D). $\overrightarrow{\mathrm{rSWR^-}} \cdot \overrightarrow{\mathrm{g_{E}g_{R}}}$ showed biphasic distributions.
\\
\indent
By taking the differences between the distribution of $\overrightarrow{\mathrm{rSWR^+}} \cdot \overrightarrow{\mathrm{g_{E}g_{R}}}$ (Figure 7A \& B) and those of $\overrightarrow{\mathrm{rSWR^-}} \cdot \overrightarrow{\mathrm{g_{E}g_{R}}}$ (Figure 7C \& D), the contributions of SWR was calculated (Figure 7E \& F), revealing a shift in the direction of $\overrightarrow{\mathrm{g_{E}g_{R}}}$ (Figure 7E \& F; \textit{red rectangles}).
\\
\indent
Additionally, only in Mismatch OUT task, $\overrightarrow{\mathrm{eSWR^+}} \cdot \overrightarrow{\mathrm{rSWR^+}}$ was less than $\overrightarrow{\mathrm{eSWR^-}} \cdot \overrightarrow{\mathrm{rSWR^-}}$ (baseline periods) (Figure 7F; \textit{pink circles}); in other words, eSWR and rSWR directed in the adverse direction solely in Mismatch OUT task but in Match IN task (Figure 7E; \textit{pink circles}).
\label{sec:results}
