%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Methods
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Methods}
\subsection{Dataset}
A publicly accessible dataset \cite{boran_dataset_2020} was employed, in which nine patients with epilepsy performed a modified Sternberg task that consisted of the following four phases: fixation (1 s), encoding (2 s), maintenance (3 s), and retrieval (2 s) \cite{boran_dataset_2020}. During the encoding phase, participants were presented sets of either four, six, or eight alphabetical letters, refered to as set size. Subsequently, they were tasked with ascertaining whether a probe letter presented in the retrieval phase had been displayed (the correct choice for Match IN task) or not (the correct choice for Mismatch OUT task). iEEG signals were recorded at a sampling rate of 32 kHz, within the frequency range of 0.5--5,000 Hz, using depth electrodes implanted in the MTL regions: the left and right hippocampal head (AHL and AHR), hippocampal body (PHL and PHR), entorhinal cortex (ECL and ECR), and amygdala (AL and AR) (Figure~\ref{fig:01}A and Table~\ref{tab:01}). Subsequently, iEEG signals were resampled at a rate of 2 kHz. Correlations were found among the experimental variables such as set size and correct rate (Figure~\ref{fig:s01}S1). The timings of multiunit spikes were estimated by a spike sorting algorithm \cite{niediek_reliable_2016} by the Combinato package ((\url{https://github.com/jniediek/combinato})(Figure~\ref{fig:01}C).

\subsection{Calculation of neural trajectories using GPFA}
To calculate the neural trajectories (also referred to as factors; Figure~\ref{fig:01}D) in the hippocampus, EC, and amygdala (Figure~\ref{fig:01}D), GPFA \cite{yu_gaussian-process_2009}, was employed on multiunit activity data for each session. GPFA was applied using the elephant package ((\url{https://elephant.readthedocs.io/en/latest/reference/gpfa.html}). The bin size was set as 50 ms, without overlaps. Each factor was z-normalized across each session. From the trajectories, Euclidean distance from the origin ($O$) was calculated (Figure~\ref{fig:01}E).
\\
\indent
For every trajectory within a region, such as AHL, \textit{geometric medians} ((\textit{i.e.}, $\mathrm{g_{F}}$ for fixation, $\mathrm{g_{E}}$ for encoding, $\mathrm{g_{M}}$ for maintenance, and $\mathrm{g_{R}}$ for retrieval phase)) were determined by calculating the median coordinates of trajectory during the four phases (Figure~\ref{fig:01}D). The optimal dimensionality for GPFA was determined as three via the elbow method utilizing the log-likelihood values using a three-fold cross-validation approach (Figure~\ref{fig:02}B).

\subsection{Defining SWR candidates from hippocampal regions}
To identify potential SWR events within the hippocampus, we employed a detection method aligned with a consensus in this field \cite{liu_consensus_2022}. Specifically, local field potential (LFP) signals from a region of interest (ROI), such as AHL, were re-referenced by subtracting a averaged signal from outside of the ROI (\textit{e.g.}, AHR, PHL, PHR, ECL, ECR, AL, and AR) (see Figure~\ref{fig:01}A). The re-referenced LFP signals were applied to a ripple-band filter (80--140 Hz) to isolate SWR candidates (= SWR$^+$ candidates) (see Figure~\ref{fig:01}B). SWR detection was conducted using a published tool ((\url{https://github.com/Eden-Kramer-Lab/ripple_detection}) \cite{kay_hippocampal_2016}, with modifications such as an updated bandpass range of 80--140 Hz for humans \cite{norman_hippocampal_2019} \cite{norman_hippocampal_2021} from original 150--250 Hz range primarily for rodents.
\\
\indent
As control events for SWR$^+$ candidates, SWR$^-$ candidates were defined by shuffling the timestamps of SWR$^+$ candidates across all trials and subjects. The defined SWR$^+$/SWR$^-$ candidates were visually inspected as shown in Figure~\ref{fig:01}.

\subsection{Defining SWRs from putative hippocampal CA1 regions}
SWRs were defined from SWR candidates in putative CA1 regions. First, putative CA1 regions were defined as follows. SWR$^+$/SWR$^-$ candidates in the hippocampus were embedded into a two-dimensional space based on their superimposed spike counts per unit using UMAP (uniform manifold approximation and projection) \cite{mcinnes_umap_2018} in a supervised fashion (Figure~\ref{fig:04}A). The silhouette score \cite{rousseeuw_silhouettes_1987}, a validation barometer for clustering, was calculated from clustered samples (Table~\ref{tab:02}). The hippocampal regions with silhouette scores greater than 0.6 on average across sessions $75^{th}$ percentile) (Figure~\ref{fig:04}B) were defined as putative CA1 regions, identifying five eletrode positions from five patients (Table~\ref{tab:03}).
\\
\indent
SWR$^+$/SWR$^-$ candidates in putative CA1 regions were defined as SWR$^+$/SWR$^-$, which are no longer candidates. The duration and ripple band peak amplitude of SWRs followed log-normal distributions (Figure~\ref{fig:04}4C \& E). SWR$^+$/SWR$^-$ were visually inspected as shown in Figure~\ref{fig:01}. Each of SWR periods was divided into the following periods based on the time from SWR center: pre- (at $-800$ to $-300$ ms from SWR center), mid- (at $-250$ to $+250$ ms), and post-SWR (at $+300$ to $+800$ ms).

\subsection{Statistical evaluation}
The Brunner--Munzel test and the Kruskal-Wallis test were executed using the scipy package in Python \cite{virtanen_scipy_2020}. A correlational analysis was undertaken through the determination of the rank of the observed correlation coefficient in the associated set-size-shuffled surrogate, using a custom Python script. Additionally, the bootstrap test was carried out by utilizing an internally developed Python script.

\label{sec:methods}